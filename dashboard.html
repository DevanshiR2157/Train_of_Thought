<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Train of Thought - Dashboard</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem 3rem;
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            color: #667eea;
            text-decoration: none;
        }
        .nav-links {
            display: flex;
            gap: 2rem;
        }
        .nav-links a {
            text-decoration: none;
            color: #333;
            font-weight: 500;
            transition: color 0.3s;
        }
        .nav-links a:hover {
            color: #667eea;
        }
        .nav-links a.active {
            color: #667eea;
            border-bottom: 2px solid #667eea;
        }
        .page {
            padding: 3rem;
            max-width: 1200px;
            margin: 0 auto;
        }
        .dashboard-container {
            background: white;
            border-radius: 20px;
            padding: 3rem;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }
        @media (max-width: 768px) {
            nav {
                flex-direction: column;
                gap: 1rem;
            }
            .page {
                padding: 1.5rem;
            }
            .dashboard-container {
                padding: 2rem;
            }
        }
    </style>
</head>
<body>
    <nav>
        <a href="index.html" class="logo">Train of Thought</a>
        <div class="nav-links">
            <a href="index.html">Home</a>
            <a href="simulator.html">Simulator</a>
            <a href="dashboard.html" class="active">Dashboard</a>
        </div>
    </nav>
    <div class="page">
        <div class="dashboard-container">
            <div id="root"></div>
        </div>
    </div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const Dashboard = () => {
          const [choices, setChoices] = useState([]);
          const [analysis, setAnalysis] = useState(null);
          const [loading, setLoading] = useState(true);

          useEffect(() => {
            loadAndAnalyzeChoices();
          }, []);

          const loadAndAnalyzeChoices = () => {
            const storedChoices = localStorage.getItem('trolleyChoices');
            
            if (!storedChoices) {
              setLoading(false);
              return;
            }

            const parsedChoices = JSON.parse(storedChoices);
            setChoices(parsedChoices);

            // Perform intelligent local analysis
            const analysisResult = performIntelligentAnalysis(parsedChoices);
            setAnalysis(analysisResult);
            setLoading(false);
          };

          // AI-Powered Local Analysis Engine
          const performIntelligentAnalysis = (choices) => {
            const patterns = {
              age: { younger: 0, older: 0, neutral: 0 },
              gender: { male: 0, female: 0, neutral: 0 },
              fitness: { athletic: 0, overweight: 0, neutral: 0 },
              status: { high: 0, low: 0, neutral: 0 },
              quantity: { saveMore: 0, saveFewer: 0, neutral: 0 }
            };

            choices.forEach(choice => {
              const saved = choice.saved;
              const sacrificed = choice.sacrificed;

              // Age analysis
              const ageComp = compareAge(saved.age, sacrificed.age);
              patterns.age[ageComp]++;

              // Gender analysis
              if (saved.gender !== sacrificed.gender) {
                patterns.gender[saved.gender]++;
              } else {
                patterns.gender.neutral++;
              }

              // Fitness analysis
              if (saved.fitness !== sacrificed.fitness) {
                if (saved.fitness === 'athletic') patterns.fitness.athletic++;
                else patterns.fitness.overweight++;
              } else {
                patterns.fitness.neutral++;
              }

              // Status analysis
              const savedStatus = getStatusLevel(saved.status);
              const sacrificedStatus = getStatusLevel(sacrificed.status);
              if (savedStatus > sacrificedStatus) patterns.status.high++;
              else if (savedStatus < sacrificedStatus) patterns.status.low++;
              else patterns.status.neutral++;

              // Quantity analysis
              if (saved.count > sacrificed.count) patterns.quantity.saveMore++;
              else if (saved.count < sacrificed.count) patterns.quantity.saveFewer++;
              else patterns.quantity.neutral++;
            });

            // Generate insights
            const insights = generateInsights(patterns, choices.length);
            const ethicalFramework = determineEthicalFramework(patterns, choices.length);
            const comparison = generatePopulationComparison(patterns, choices.length);

            return {
              agePreference: patterns.age,
              genderPreference: patterns.gender,
              fitnessPreference: patterns.fitness,
              statusPreference: patterns.status,
              utilitarian: patterns.quantity,
              ethicalFramework: ethicalFramework,
              keyInsights: insights,
              comparisonToPopulation: comparison
            };
          };

          const compareAge = (age1, age2) => {
            const ageOrder = ['child', 'young', 'adult', 'middle', 'elderly'];
            const idx1 = ageOrder.findIndex(a => age1.toLowerCase().includes(a));
            const idx2 = ageOrder.findIndex(a => age2.toLowerCase().includes(a));
            if (idx1 === -1 || idx2 === -1) return 'neutral';
            if (idx1 < idx2) return 'younger';
            if (idx1 > idx2) return 'older';
            return 'neutral';
          };

          const getStatusLevel = (status) => {
            const statusMap = {
              'doctor': 5, 'ceo': 5, 'executive': 5,
              'teacher': 4, 'engineer': 4,
              'worker': 3, 'employee': 3,
              'unemployed': 2,
              'homeless': 1
            };
            for (let key in statusMap) {
              if (status.toLowerCase().includes(key)) return statusMap[key];
            }
            return 3;
          };

          const generateInsights = (patterns, total) => {
            const insights = [];

            // Age insight
            const ageYoungerPct = (patterns.age.younger / total * 100);
            if (ageYoungerPct > 60) {
              insights.push(`You showed a strong preference for saving younger people (${Math.round(ageYoungerPct)}%), suggesting you value potential life years over experience.`);
            } else if (patterns.age.older > patterns.age.younger) {
              insights.push(`Interestingly, you preferred saving older individuals, possibly valuing wisdom and life experience over youth.`);
            }

            // Quantity insight
            const utilPct = (patterns.quantity.saveMore / total * 100);
            if (utilPct > 70) {
              insights.push(`You demonstrated strong utilitarian thinking by prioritizing the greatest number of lives saved (${Math.round(utilPct)}% of the time).`);
            } else if (patterns.quantity.saveFewer > patterns.quantity.saveMore) {
              insights.push(`You often chose quality over quantity, suggesting deontological or virtue-based ethical reasoning.`);
            }

            // Status insight
            const statusHighPct = (patterns.status.high / total * 100);
            if (statusHighPct > 60) {
              insights.push(`You tended to save higher-status individuals, which may reflect societal value judgments or perceived social utility.`);
            } else if (patterns.status.low > patterns.status.high) {
              insights.push(`You showed compassion by often choosing to save lower-status individuals, demonstrating egalitarian values.`);
            }

            // Gender insight
            if (patterns.gender.male > patterns.gender.female * 1.5) {
              insights.push(`Your choices showed a gender bias toward saving males, which is common but worth examining.`);
            } else if (patterns.gender.female > patterns.gender.male * 1.5) {
              insights.push(`You tended to save females more often, possibly reflecting protective instincts or social conditioning.`);
            } else if (patterns.gender.neutral > total * 0.5) {
              insights.push(`You showed no significant gender bias, treating male and female lives equally in your decisions.`);
            }

            // Fitness insight
            if (patterns.fitness.athletic > patterns.fitness.overweight * 1.5) {
              insights.push(`You favored saving athletic individuals, potentially reflecting biases about health, productivity, or appearance.`);
            }

            return insights.slice(0, 4); // Return top 4 insights
          };

          const determineEthicalFramework = (patterns, total) => {
            const utilScore = patterns.quantity.saveMore / total;
            const statusScore = patterns.status.high / total;
            const ageScore = patterns.age.younger / total;

            if (utilScore > 0.7) {
              return "Utilitarian - You prioritize maximizing overall welfare and saving the greatest number of people.";
            } else if (statusScore > 0.6 && ageScore > 0.6) {
              return "Consequentialist with Social Value - You consider both immediate outcomes and potential future contributions to society.";
            } else if (patterns.quantity.saveFewer > patterns.quantity.saveMore) {
              return "Deontological - You follow rule-based ethics, possibly believing certain actions are inherently right or wrong regardless of outcomes.";
            } else if (patterns.status.low > patterns.status.high) {
              return "Egalitarian/Care Ethics - You prioritize fairness and show concern for the most vulnerable members of society.";
            } else {
              return "Mixed/Situational Ethics - You apply different ethical frameworks depending on the specific circumstances of each dilemma.";
            }
          };

          const generatePopulationComparison = (patterns, total) => {
            const utilPct = Math.round(patterns.quantity.saveMore / total * 100);
            const ageYoungerPct = Math.round(patterns.age.younger / total * 100);

            // Simulated population data based on moral machine research
            const avgUtilitarian = 68;
            const avgYoungerPref = 72;

            let comparison = "Compared to research on thousands of participants: ";

            if (utilPct > avgUtilitarian + 15) {
              comparison += "You're significantly more utilitarian than average. ";
            } else if (utilPct < avgUtilitarian - 15) {
              comparison += "You're less utilitarian than most people. ";
            } else {
              comparison += "Your utilitarian thinking is close to the population average. ";
            }

            if (ageYoungerPct > avgYoungerPref + 15) {
              comparison += "You show a stronger preference for saving younger people than typical. ";
            } else if (ageYoungerPct < avgYoungerPref - 15) {
              comparison += "You're more willing to save older individuals than most. ";
            }

            comparison += "These patterns reflect your unique moral philosophy shaped by personal experiences and values.";

            return comparison;
          };

          const getTotal = (pref) => {
            return Object.values(pref).reduce((sum, val) => sum + val, 0) || 1;
          };

          const getPercentage = (val, pref) => {
            const total = getTotal(pref);
            return Math.round((val / total) * 100);
          };

          const resetData = () => {
            localStorage.removeItem('trolleyChoices');
            window.location.href = './simulator.html';
          };

          if (loading) {
            return (
              <div style={{ textAlign: 'center', padding: '4rem 0' }}>
                <div style={{ width: '60px', height: '60px', border: '4px solid #f3f4f6', borderTop: '4px solid #667eea', borderRadius: '50%', margin: '0 auto 2rem', animation: 'spin 1s linear infinite' }} />
                <h2 style={{ color: '#667eea', marginBottom: '0.5rem' }}>Analyzing Your Moral Patterns</h2>
                <p style={{ color: '#666' }}>AI is processing your decision patterns...</p>
                <style>{`@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }`}</style>
              </div>
            );
          }

          if (!choices || choices.length === 0) {
            return (
              <div style={{ textAlign: 'center', padding: '4rem 2rem' }}>
                <div style={{ fontSize: '4rem', marginBottom: '1rem' }}>ðŸ“Š</div>
                <h2 style={{ color: '#667eea', marginBottom: '1rem' }}>No Data Available</h2>
                <p style={{ color: '#666', marginBottom: '2rem' }}>Complete the simulator first to see your moral profile analysis.</p>
                <a href="./simulator.html" style={{ display: 'inline-block', background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', color: 'white', padding: '0.75rem 2rem', borderRadius: '50px', textDecoration: 'none', fontWeight: 'bold' }}>Start Simulator</a>
              </div>
            );
          }

          return (
            <div>
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '2rem' }}>
                <h2 style={{ color: '#667eea', margin: 0 }}>ðŸ§  Your AI-Analyzed Moral Profile</h2>
                <button onClick={resetData} style={{ background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', color: 'white', padding: '0.75rem 1.5rem', borderRadius: '50px', border: 'none', fontWeight: 'bold', cursor: 'pointer' }}>Take New Test</button>
              </div>

              {analysis && (
                <>
                  <div style={{ background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', color: 'white', borderRadius: '15px', padding: '2rem', marginBottom: '2rem' }}>
                    <h3 style={{ fontSize: '1.3rem', fontWeight: 'bold', marginBottom: '0.75rem' }}>Ethical Framework Detected</h3>
                    <p style={{ fontSize: '1.1rem', margin: 0 }}>{analysis.ethicalFramework}</p>
                  </div>

                  <div style={{ display: 'grid', gridTemplateColumns: window.innerWidth > 768 ? '1fr 1fr' : '1fr', gap: '1.5rem', marginBottom: '2rem' }}>
                    {[
                      { title: 'Age Preference', label: 'Saved Younger People', pref: analysis.agePreference, key: 'younger', color: '#3b82f6' },
                      { title: 'Gender Preference', label: 'Saved Male', pref: analysis.genderPreference, key: 'male', color: '#a855f7' },
                      { title: 'Fitness Preference', label: 'Saved Athletic', pref: analysis.fitnessPreference, key: 'athletic', color: '#22c55e' },
                      { title: 'Status Preference', label: 'Saved Higher Status', pref: analysis.statusPreference, key: 'high', color: '#f59e0b' },
                      { title: 'Utilitarian Score', label: 'Saved More People', pref: analysis.utilitarian, key: 'saveMore', color: '#ef4444' }
                    ].map((item, idx) => (
                      <div key={idx} style={{ background: 'linear-gradient(135deg, #667eea15 0%, #764ba215 100%)', borderRadius: '15px', padding: '1.5rem' }}>
                        <h3 style={{ color: '#667eea', marginBottom: '1rem', fontSize: '1.1rem', fontWeight: '600' }}>{item.title}</h3>
                        <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '0.5rem' }}>
                          <span style={{ fontSize: '0.9rem', color: '#555' }}>{item.label}</span>
                          <span style={{ fontWeight: 'bold', color: item.color }}>{getPercentage(item.pref[item.key], item.pref)}%</span>
                        </div>
                        <div style={{ width: '100%', background: '#e5e7eb', borderRadius: '50px', height: '10px', overflow: 'hidden' }}>
                          <div style={{ width: `${getPercentage(item.pref[item.key], item.pref)}%`, background: item.color, height: '100%', borderRadius: '50px', transition: 'width 0.5s ease' }} />
                        </div>
                      </div>
                    ))}
                  </div>

                  <div style={{ background: 'linear-gradient(135deg, #667eea15 0%, #764ba215 100%)', borderRadius: '15px', padding: '2rem', marginBottom: '2rem', border: '2px solid rgba(102, 126, 234, 0.3)' }}>
                    <h3 style={{ color: '#667eea', marginBottom: '1rem', fontSize: '1.2rem', fontWeight: '600', display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
                      <span>ðŸ§ </span>
                      AI-Generated Key Insights
                    </h3>
                    <ul style={{ listStyle: 'none', padding: 0, margin: 0 }}>
                      {analysis.keyInsights.map((insight, idx) => (
                        <li key={idx} style={{ background: 'white', padding: '1rem', borderRadius: '10px', marginBottom: '0.75rem', color: '#555', display: 'flex', alignItems: 'start', gap: '0.75rem' }}>
                          <span style={{ color: '#667eea', fontWeight: 'bold', fontSize: '1.2rem' }}>â€¢</span>
                          <span style={{ flex: 1 }}>{insight}</span>
                        </li>
                      ))}
                    </ul>
                  </div>

                  <div style={{ background: 'linear-gradient(135deg, #a855f715 0%, #ec489915 100%)', borderRadius: '15px', padding: '2rem', marginBottom: '2rem', border: '2px solid rgba(168, 85, 247, 0.3)' }}>
                    <h3 style={{ color: '#a855f7', marginBottom: '1rem', fontSize: '1.2rem', fontWeight: '600', display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
                      <span>ðŸ‘¥</span>
                      Population Comparison
                    </h3>
                    <p style={{ color: '#555', lineHeight: '1.6', margin: 0 }}>{analysis.comparisonToPopulation}</p>
                  </div>
                </>
              )}

              <div style={{ background: 'white', border: '2px solid #e5e7eb', borderRadius: '15px', padding: '2rem' }}>
                <h3 style={{ color: '#667eea', marginBottom: '1.5rem', fontSize: '1.3rem', fontWeight: '600' }}>Your Decision History</h3>
                <div style={{ display: 'flex', flexDirection: 'column', gap: '1rem' }}>
                  {choices.map((choice, idx) => (
                    <div key={idx} style={{ background: '#f9fafb', borderRadius: '10px', padding: '1.5rem', borderLeft: '4px solid #667eea' }}>
                      <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '0.75rem', alignItems: 'center' }}>
                        <span style={{ fontWeight: '600', color: '#667eea' }}>Scenario {choice.scenarioNum}</span>
                        <span style={{ fontSize: '0.85rem', color: '#999' }}>{new Date(choice.timestamp).toLocaleString()}</span>
                      </div>
                      <div style={{ display: 'grid', gridTemplateColumns: window.innerWidth > 768 ? '1fr 1fr' : '1fr', gap: '1rem', fontSize: '0.95rem' }}>
                        <div style={{ background: '#d1fae5', padding: '1rem', borderRadius: '8px', border: '1px solid #6ee7b7' }}>
                          <div style={{ fontWeight: '600', color: '#059669', marginBottom: '0.5rem' }}>âœ“ Saved</div>
                          <div style={{ color: '#555' }}>{choice.saved.description}</div>
                        </div>
                        <div style={{ background: '#fee2e2', padding: '1rem', borderRadius: '8px', border: '1px solid #fca5a5' }}>
                          <div style={{ fontWeight: '600', color: '#dc2626', marginBottom: '0.5rem' }}>âœ— Sacrificed</div>
                          <div style={{ color: '#555' }}>{choice.sacrificed.description}</div>
                        </div>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            </div>
          );
        };

        ReactDOM.render(<Dashboard />, document.getElementById('root'));
    </script>
</body>
</html>
